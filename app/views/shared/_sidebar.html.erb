<!-- Sidebar -->
<div id="hs-application-sidebar" class="hs-overlay  [--auto-close:lg]
  hs-overlay-open:translate-x-0
  -translate-x-full transition-all duration-300 transform
  w-65 h-full
  hidden
  fixed inset-y-0 start-0 z-60
  bg-white border-e border-gray-200
  lg:block lg:translate-x-0 lg:end-auto lg:bottom-0
  dark:bg-neutral-800 dark:border-neutral-700" role="dialog" tabindex="-1" aria-label="Sidebar">
  <div class="relative flex flex-col h-full max-h-full">
    <div class="px-6 pt-4">
      <!-- Logo -->
      <a class="flex-none rounded-xl text-xl inline-block font-semibold" href="#">
        <h1>Ontrack App</h1>
      </a>
    </div>

    <!-- MENU -->
    <div class="h-full overflow-y-auto 
                [&::-webkit-scrollbar]:w-2 
                [&::-webkit-scrollbar-thumb]:rounded-full 
                [&::-webkit-scrollbar-track]:bg-gray-100 
                [&::-webkit-scrollbar-thumb]:bg-gray-300 
                dark:[&::-webkit-scrollbar-track]:bg-neutral-700 
                dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500">

      <nav class="hs-accordion-group p-3 w-full flex flex-col flex-wrap" data-hs-accordion-always-open>
        <ul class="flex flex-col space-y-1" data-hs-scrollspy="#scrollspy">
          <li>
            <a class="flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-neutral-700" 
              href="/onboardings">
              <!-- Icon -->
              Onboardings
            </a>
          </li>

          <li>
            <a class="flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-neutral-700" 
              href="#users">
              <!-- Icon -->
              Templates
            </a>
          </li>
        </ul>
      </nav>

    </div>

    <!-- USUÁRIO FIXADO EMBAIXO -->
    <% if user_signed_in? %>
      <div class="p-3 mt-auto">
        <details class="group relative">
          <summary class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-neutral-700 cursor-pointer list-none">
            
            <!-- Avatar -->
            <div class="flex-none w-10 h-10 rounded-full bg-gray-200 dark:bg-neutral-700 flex items-center justify-center text-sm font-semibold text-gray-800 dark:text-neutral-100">
              <% if current_user.respond_to?(:avatar) && current_user.avatar.attached? %>
                <%= image_tag current_user.avatar.variant(resize_to_fill: [40,40]), class: "w-10 h-10 rounded-full" %>
              <% else %>
                <% initials = (current_user.full_name.presence || current_user.email).split.map(&:first).first(2).join.upcase %>
                <span><%= initials %></span>
              <% end %>
            </div>

            <!-- Nome / email -->
            <div class="min-w-0">
              <div class="text-sm font-semibold text-gray-900 dark:text-neutral-100 truncate">
                <%= current_user.full_name.presence || current_user.email %>
              </div>
              <div class="text-xs text-gray-500 dark:text-neutral-400 truncate">
                <%= current_user.email %>
              </div>
            </div>

          </summary>

          <!-- MENU DROPDOWN (abertura lateral) -->
          <div class="absolute bottom-full left-0 mb-2 
                      bg-white dark:bg-neutral-800 border border-gray-200 dark:border-neutral-700 
                      rounded-lg shadow-lg p-2 z-50">

            <%= link_to 'Perfil', profile_path, class: 'block px-3 py-2 text-sm rounded hover:bg-gray-50 dark:hover:bg-neutral-700' %>
            <%= link_to 'Configurações', '#', class: 'block px-3 py-2 text-sm rounded hover:bg-gray-50 dark:hover:bg-neutral-700' %>

            <div class="border-t my-1 dark:border-neutral-700"></div>

            <%= button_to 'Sair', destroy_user_session_path, method: :delete,
                class: 'w-full text-left px-3 py-2 text-sm rounded hover:bg-gray-50 dark:hover:bg-neutral-700' %>
          </div>
        </details>
      </div>
    <% end %>
  </div>
</div>
<!-- End Sidebar -->