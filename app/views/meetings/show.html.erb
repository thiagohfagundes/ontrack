<% content_for :title, (@meeting.title.presence || "Detalhes da reunião") %>
<div class="space-y-8">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 text-green-600 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <!-- Header -->
  <div class="flex flex-col gap-6 px-4 md:px-0">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
      <div class="min-w-0 flex-1">
        <p class="text-sm font-medium text-gray-500 dark:text-neutral-400 mb-1">Detalhes da reunião</p>
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-neutral-100 truncate"><%= @meeting.title.presence || "Sem título" %></h1>

        <div class="mt-3 flex items-center gap-4 flex-wrap text-sm text-gray-600 dark:text-neutral-400">
          <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold <%= status_badge_class(@meeting.outcome) rescue 'bg-gray-100 text-gray-800' %>">
            <%= (@meeting.outcome.presence || 'Scheduled').to_s.upcase %>
          </span>

          <div class="flex items-center gap-2">
            <span class="text-xs text-gray-400">Início</span>
            <span class="ml-1"><%= @meeting.start_time.present? ? l(@meeting.start_time, format: :short) : '—' %></span>
          </div>

          <div class="flex items-center gap-2">
            <span class="text-xs text-gray-400">Local</span>
            <span class="ml-1"><%= @meeting.location.presence || '—' %></span>
          </div>

          <div class="text-sm">
            <span class="text-xs text-gray-400">Onboarding</span>
            <span class="ml-1"><%= link_to @meeting.onboarding.title.truncate(30), onboarding_path(@meeting.onboarding), class: "text-blue-600 hover:underline dark:text-blue-400" %></span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
        <% if @meeting.outcome.to_s.downcase != 'completed' %>
          <button type="button" class="inline-flex items-center gap-2 px-4 py-2.5 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm font-semibold shadow transition">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
            Marcar como concluída
          </button>
        <% end %>

        <%= link_to "Editar", edit_onboarding_meeting_path(@meeting.onboarding, @meeting), class: "inline-flex items-center justify-center px-4 py-2.5 rounded-lg border border-gray-300 text-gray-700 text-sm font-medium hover:bg-gray-50 shadow-sm transition dark:border-neutral-600 dark:text-neutral-300 dark:hover:bg-neutral-700" %>

        <%= link_to "← Voltar", onboarding_path(@meeting.onboarding), class: "inline-flex items-center justify-center px-4 py-2.5 text-gray-600 text-sm font-medium hover:text-gray-900 transition dark:text-neutral-400 dark:hover:text-neutral-200" %>
      </div>
    </div>
  </div>

  <!-- Main grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 px-4 md:px-0 mt-4">
    <!-- Left: description, notes, attachments, comments -->
    <main class="lg:col-span-2 space-y-6">

      <section class="bg-white rounded-xl shadow-md ring-1 ring-slate-100 p-6 space-y-3">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-neutral-100">Descrição / Agenda</h2>
        <div class="text-sm text-gray-700 dark:text-neutral-300 leading-relaxed">
          <% if @meeting.body.present? %>
            <%= simple_format(@meeting.body) %>
          <% else %>
            <p class="text-gray-500 dark:text-neutral-400 italic">Nenhuma descrição fornecida.</p>
          <% end %>
        </div>

        <div class="mt-4">
          <h3 class="text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase">Notas internas</h3>
          <div class="mt-2 text-sm text-gray-700 dark:text-neutral-300 bg-gray-50 dark:bg-neutral-800 p-4 rounded-md">
            <% if @meeting.internal_notes.present? %>
              <%= simple_format(@meeting.internal_notes) %>
            <% else %>
              <p class="text-gray-500 dark:text-neutral-400">Nenhuma nota interna.</p>
            <% end %>
          </div>
        </div>
      </section>

      <section class="bg-white rounded-xl shadow-md ring-1 ring-slate-100 p-6 space-y-3">
        <h3 class="text-md font-semibold text-gray-900 dark:text-neutral-100">Anexos</h3>
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center bg-gray-50 dark:bg-neutral-900 dark:border-neutral-700">
          <svg class="mx-auto h-8 w-8 text-gray-400 dark:text-neutral-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <p class="text-sm text-gray-600 dark:text-neutral-400">Ainda não há anexos — espaço reservado.</p>
        </div>
      </section>

      <section class="bg-white rounded-xl shadow-md ring-1 ring-slate-100 p-6 space-y-3">
        <h3 class="text-md font-semibold text-gray-900 dark:text-neutral-100">Comentários</h3>
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center bg-gray-50 dark:bg-neutral-900 dark:border-neutral-700">
          <svg class="mx-auto h-8 w-8 text-gray-400 dark:text-neutral-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
          </svg>
          <p class="text-sm text-gray-600 dark:text-neutral-400">Sistema de comentários em desenvolvimento.</p>
        </div>
      </section>
    </main>

    <!-- Right: metadata and participants -->
    <aside class="space-y-6">

      <section class="bg-white rounded-xl shadow-md ring-1 ring-slate-100 p-6 space-y-3">
        <h3 class="text-md font-semibold text-gray-900 dark:text-neutral-100">Datas & status</h3>
        <dl class="space-y-3 text-sm text-gray-700 dark:text-neutral-300">
          <div class="flex justify-between">
            <dt class="text-xs text-gray-500 dark:text-neutral-400">Início</dt>
            <dd class="font-medium"><%= @meeting.start_time.present? ? l(@meeting.start_time, format: :short) : '—' %></dd>
          </div>

          <div class="flex justify-between">
            <dt class="text-xs text-gray-500 dark:text-neutral-400">Término</dt>
            <dd class="font-medium"><%= @meeting.end_time.present? ? l(@meeting.end_time, format: :short) : '—' %></dd>
          </div>

          <div class="flex justify-between">
            <dt class="text-xs text-gray-500 dark:text-neutral-400">Local</dt>
            <dd class="font-medium"><%= @meeting.location.presence || '—' %></dd>
          </div>

          <div class="flex justify-between">
            <dt class="text-xs text-gray-500 dark:text-neutral-400">Outcome</dt>
            <dd class="font-medium"><%= @meeting.outcome.presence || '—' %></dd>
          </div>

          <div class="flex justify-between">
            <dt class="text-xs text-gray-500 dark:text-neutral-400">HubSpot ID</dt>
            <dd class="text-xs text-gray-500"><%= @meeting.hubspot_id.presence || '—' %></dd>
          </div>
        </dl>
      </section>

      <section class="bg-white rounded-xl shadow-md ring-1 ring-slate-100 p-6 space-y-3">
        <h3 class="text-md font-semibold text-gray-900 dark:text-neutral-100">Participantes</h3>
        <% participants = (@meeting.respond_to?(:participants) ? @meeting.participants : @meeting.onboarding.participants) %>

        <% if participants.any? %>
          <ul class="space-y-3">
            <% participants.limit(6).each do |p| %>
              <li class="flex items-center gap-3">
                <%= image_tag avatar_for(p), class: "w-8 h-8 rounded-full flex-shrink-0" %>
                <div class="min-w-0">
                  <p class="text-sm font-medium text-gray-900 dark:text-neutral-100 truncate"><%= "#{p.firstname} #{p.lastname}" %></p>
                  <p class="text-xs text-gray-500 dark:text-neutral-400 truncate"><%= p.email %></p>
                </div>
              </li>
            <% end %>
          </ul>

          <% if participants.count > 6 %>
            <div class="mt-3 text-sm text-gray-500">+<%= participants.count - 6 %> restantes</div>
          <% end %>
        <% else %>
          <p class="text-sm text-gray-500">Nenhum participante listado.</p>
        <% end %>
      </section>

      <section class="bg-white rounded-xl shadow-md ring-1 ring-slate-100 p-4 space-y-3">
        <h4 class="text-sm font-semibold text-gray-900 dark:text-neutral-100">Ações rápidas</h4>
        <div class="flex flex-col gap-2">
          <%= link_to "Ver onboarding", onboarding_path(@meeting.onboarding), class: "text-sm text-left px-3 py-2 rounded-md hover:bg-gray-50 dark:hover:bg-neutral-800" %>
          <%= link_to "Criar follow-up", new_onboarding_meeting_path(@meeting.onboarding, meeting: { title: "Follow-up: #{@meeting.title}" }), class: "text-sm text-left px-3 py-2 rounded-md hover:bg-gray-50 dark:hover:bg-neutral-800" %>
        </div>
      </section>

    </aside>
  </div>
</div>
      </aside>
    </div>
  </div>
</div>
